{% extends "base_templates/dashboard_base.html" %}

{% block title %}
Dashboard
{% endblock %}

{% block content %}
<!-- Page Heading -->
<h1 class="h3 mt-3 mb-4 text-gray-800">Dashboard</h1>

<div class="card border-left-success shadow p-3">
<div class="row">
    <div class="col-sm-8">
        <h3>Time Remaining in Trial: <span id="timer" class="timer"></span></h3>
    </div>
</div>

<div class="row">
    <div class="col-sm-12">
        <p>When the timer ends, your trial period is over.</p>
    </div>
</div>
<div class="shift-down">
<button onclick="goToCheckout()">Subscribe Now</button>
<script src="https://js.stripe.com/v3/"></script>
<script>
var stripe = Stripe("{{ STRIPE_PUBLIC_KEY }}");
function goToCheckout() {
    stripe.redirectToCheckout({
        // Make the id field from the Checkout Session creation API response
        // available to this file, so you can provide it as parameter here
        // instead of the {{CHECKOUT_SESSION_ID}} placeholder.
        sessionId: '{{ session_id }}'
    }).then(function (result) {
        // If `redirectToCheckout` fails due to a browser or network
        // error, display the localized error message to your customer
        // using `result.error.message`.
    });
}

</script>

<!-- 
<form action="/paynow" method="POST">
  <script
    src="https://checkout.stripe.com/checkout.js" class="stripe-button"
    data-key="{{ STRIPE_PUBLIC_KEY }}"
    data-name="SaaS ML App"
    data-description="ML Service Subscription"
    data-amount="2000"
    data-label="Pay Now!"
    data-email="{{ email }}" 
    data-allow-remember-me="false">
  </script>
</form>
-->
</div>
<script>
var expiredDate = new Date("{{ expire_date }}");

// Update the count down every 1 second
var countDown = function () {

    // Get todays date and time
    var now = new Date().getTime();

    // Find the distance between now an the count down date
    var distance = expiredDate.getTime() - now;

    // Time calculations for days, hours, minutes and seconds
    var days = Math.floor(distance / (1000 * 60 * 60 * 24));
    var hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
    var minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
    var seconds = Math.floor((distance % (1000 * 60)) / 1000);

    // Display the result in the element with id="demo"
    if (days > 0) {
        countdown = days + "d " + hours + "h " + minutes + "m " + seconds + "s";
    }
    else {
        countdown = hours + "h " + minutes + "m " + seconds + "s";
    }

    document.getElementById("timer").innerHTML = countdown

    // If the count down is finished, write some text
    if (distance < 0) {
        clearInterval(x);
        document.getElementById("timer").innerHTML = "EXPIRED";
        document.getElementById("paynow").style.visibility = "hidden";
    }

};
countDown();
var x = setInterval(countDown, 1000);
</script>
{% endblock %}
